<!-- xmenu.dev / index.html (entire corrected file) -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>XMenu - Your iPad Experience</title>
    <script>
      // Redirect to local security verification
      (function() {
        // Helper function to safely get cookie value
        function getCookie(name) {
          const value = "; " + document.cookie;
          const parts = value.split("; " + name + "=");
          if (parts.length === 2) return parts.pop().split(";").shift();
          return null;
        }

        // Check localStorage for persisted verification (fallback for environments
        // where the Secure cookie flag may not work, e.g. HTTP dev servers)
        function isLocalStorageVerified() {
          try {
            const expiry = parseInt(localStorage.getItem('xmenu_security_expiry') || '0');
            return localStorage.getItem('xmenu_security_verified') === 'true' && Date.now() < expiry;
          } catch (e) {
            return false;
          }
        }

        function storeVerification() {
          const expiryMs = Date.now() + 24 * 60 * 60 * 1000; // 24 hours
          // Cookie (works when served over HTTPS)
          const expires = new Date(expiryMs).toUTCString();
          document.cookie = "xmenu_security_verified=true; expires=" + expires + "; path=/; SameSite=Lax";
          // localStorage fallback (works in all environments)
          try {
            localStorage.setItem('xmenu_security_verified', 'true');
            localStorage.setItem('xmenu_security_expiry', expiryMs.toString());
          } catch (e) { /* storage unavailable */ }
        }
        
        // Check if user was just verified (via URL parameter, cookie, or localStorage)
        const urlParams = new URLSearchParams(window.location.search);
        const isVerified = urlParams.get('verified') === 'true' || 
                          getCookie('xmenu_security_verified') === 'true' ||
                          isLocalStorageVerified();
        
        if (!isVerified) {
          // Not verified â€“ redirect to local security check
          const currentUrl = encodeURIComponent(window.location.href);
          window.location.replace("security.html?returnTo=" + currentUrl);
        } else if (urlParams.get('verified')) {
          // User just passed the security check â€“ persist verification so the
          // site stays unlocked for this user without requiring re-verification.
          storeVerification();

          // Clean up verification parameter while preserving other params
          urlParams.delete('verified');
          const search = urlParams.toString();
          const cleanUrl = window.location.origin + window.location.pathname + 
                          (search ? '?' + search : '') + window.location.hash;
          window.history.replaceState({}, document.title, cleanUrl);
        }
      })();
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        color-scheme: dark;
        font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background-color: #0f172a;
        color: #e2e8f0;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        margin: 0;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: radial-gradient(circle at top, #1e293b, #0f172a 65%);
        padding: 48px 20px;
      }

      main {
        width: min(960px, 100%);
        background: rgba(15, 23, 42, 0.85);
        border: 1px solid rgba(148, 163, 184, 0.2);
        border-radius: 28px;
        padding: 56px clamp(24px, 5vw, 64px);
        box-shadow: 0 30px 80px rgba(15, 23, 42, 0.45);
        display: grid;
        gap: 40px;
        backdrop-filter: blur(10px);
      }

      header {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .eyebrow {
        text-transform: uppercase;
        letter-spacing: 0.32em;
        font-size: 0.75rem;
        color: #94a3b8;
        font-weight: 600;
      }

      h1 {
        margin: 0;
        font-size: clamp(2.4rem, 4vw, 3.6rem);
        color: #f8fafc;
        font-weight: 700;
        line-height: 1.2;
      }

      p {
        margin: 0;
        font-size: 1.05rem;
        color: #cbd5e1;
        line-height: 1.7;
      }

      .actions {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        margin-top: 8px;
      }

      .button {
        text-decoration: none;
        font-weight: 600;
        padding: 14px 28px;
        border-radius: 999px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        transition: all 0.2s ease;
        border: 1px solid transparent;
        cursor: pointer;
        font-size: 0.95rem;
        font-family: inherit;
      }

      .button.primary {
        background: linear-gradient(135deg, #38bdf8, #0ea5e9);
        color: #0f172a;
        box-shadow: 0 14px 32px rgba(56, 189, 248, 0.35);
      }

      .button.primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 18px 40px rgba(56, 189, 248, 0.45);
      }

      .button.secondary {
        background: transparent;
        color: #e2e8f0;
        border-color: rgba(148, 163, 184, 0.4);
      }

      .button.secondary:hover {
        transform: translateY(-2px);
        background: rgba(148, 163, 184, 0.1);
        border-color: rgba(148, 163, 184, 0.6);
      }

      .details {
        display: grid;
        gap: 16px;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      }

      .detail-card {
        background: rgba(30, 41, 59, 0.7);
        border: 1px solid rgba(148, 163, 184, 0.2);
        border-radius: 20px;
        padding: 24px 24px;
        transition: all 0.3s ease;
      }

      .detail-card:hover {
        transform: translateY(-4px);
        border-color: rgba(56, 189, 248, 0.4);
        box-shadow: 0 12px 32px rgba(56, 189, 248, 0.15);
      }

      .detail-card h2 {
        margin: 0 0 10px;
        font-size: 1.15rem;
        color: #f1f5f9;
        font-weight: 600;
      }

      .detail-card p {
        font-size: 0.95rem;
        color: #cbd5e1;
        line-height: 1.6;
      }

      footer {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        align-items: center;
        justify-content: space-between;
        color: #94a3b8;
        font-size: 0.9rem;
        padding-top: 8px;
        border-top: 1px solid rgba(148, 163, 184, 0.15);
      }

      .footer-note {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .pill {
        background: rgba(56, 189, 248, 0.15);
        color: #7dd3fc;
        border-radius: 999px;
        padding: 6px 14px;
        font-weight: 600;
        font-size: 0.75rem;
        border: 1px solid rgba(56, 189, 248, 0.3);
      }

      .language-switcher {
        position: fixed;
        top: 24px;
        right: 24px;
        z-index: 10000;
        display: flex;
        gap: 8px;
        background: rgba(15, 23, 42, 0.95);
        border: 1px solid rgba(148, 163, 184, 0.25);
        border-radius: 999px;
        padding: 6px;
        backdrop-filter: blur(10px);
        box-shadow: 0 8px 24px rgba(15, 23, 42, 0.4);
      }

      .lang-btn {
        appearance: none;
        border: none;
        background: transparent;
        color: #94a3b8;
        padding: 8px 16px;
        border-radius: 999px;
        font-size: 0.85rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        font-family: inherit;
      }

      .lang-btn:hover {
        color: #e2e8f0;
        background: rgba(148, 163, 184, 0.1);
      }

      .lang-btn.active {
        background: linear-gradient(135deg, #38bdf8, #0ea5e9);
        color: #0f172a;
        box-shadow: 0 4px 12px rgba(56, 189, 248, 0.3);
      }

      .asset-loader {
        position: fixed;
        right: 18px;
        bottom: 18px;
        width: min(360px, calc(100vw - 36px));
        background: rgba(15, 23, 42, 0.95);
        border: 1px solid rgba(148, 163, 184, 0.25);
        border-radius: 18px;
        box-shadow: 0 24px 70px rgba(15, 23, 42, 0.6);
        padding: 16px 16px 14px;
        display: grid;
        gap: 12px;
        z-index: 9999;
        opacity: 1;
        transform: translateY(0);
        transition: opacity 250ms ease, transform 250ms ease;
        backdrop-filter: blur(10px);
      }

      .asset-loader.hidden {
        opacity: 0;
        transform: translateY(12px);
        pointer-events: none;
      }

      .asset-top {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
      }

      .asset-title {
        display: grid;
        gap: 4px;
      }

      .asset-title strong {
        color: #f8fafc;
        font-size: 0.98rem;
        line-height: 1.2;
        font-weight: 600;
      }

      .asset-title span {
        color: #94a3b8;
        font-size: 0.85rem;
      }

      .asset-actions {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .skip-btn {
        appearance: none;
        border: 1px solid rgba(148, 163, 184, 0.35);
        background: transparent;
        color: #e2e8f0;
        border-radius: 999px;
        padding: 8px 12px;
        font-weight: 600;
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.15s ease;
        font-family: inherit;
      }

      .skip-btn:hover {
        transform: translateY(-1px);
        background: rgba(148, 163, 184, 0.1);
        border-color: rgba(148, 163, 184, 0.5);
      }

      .mini-spinner {
        width: 20px;
        height: 20px;
        border-radius: 999px;
        border: 2px solid rgba(148, 163, 184, 0.25);
        border-top-color: #38bdf8;
        animation: spin 700ms linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .asset-progress {
        height: 10px;
        border-radius: 999px;
        background: rgba(148, 163, 184, 0.18);
        overflow: hidden;
        border: 1px solid rgba(148, 163, 184, 0.15);
      }

      .asset-progress > div {
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, #38bdf8, #0ea5e9);
        transition: width 200ms ease;
      }

      .asset-detail {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        color: #94a3b8;
        font-size: 0.85rem;
      }

      .asset-badge {
        background: rgba(56, 189, 248, 0.15);
        color: #7dd3fc;
        border-radius: 999px;
        padding: 5px 12px;
        font-weight: 700;
        font-size: 0.75rem;
        border: 1px solid rgba(56, 189, 248, 0.3);
      }

      .support-panel {
        background: rgba(30, 41, 59, 0.75);
        border: 1px solid rgba(148, 163, 184, 0.2);
        border-radius: 20px;
        display: grid;
        gap: 20px;
        overflow: hidden;
        max-height: 0;
        opacity: 0;
        transform: translateY(-16px);
        pointer-events: none;
        padding: 0 clamp(20px, 4vw, 36px);
        transition: max-height 0.45s ease, opacity 0.35s ease, transform 0.35s ease, padding 0.35s ease;
      }

      .support-panel.support-panel--open {
        max-height: 3600px; /* large enough for any realistic form content */
        opacity: 1;
        transform: translateY(0);
        pointer-events: auto;
        padding: 32px clamp(20px, 4vw, 36px);
      }

      .support-panel h2 {
        margin: 0;
        color: #f8fafc;
        font-size: 1.5rem;
        font-weight: 600;
      }

      .support-panel p {
        color: #cbd5e1;
        font-size: 1rem;
        line-height: 1.6;
      }

      .support-form {
        display: grid;
        gap: 18px;
      }

      .support-grid {
        display: grid;
        gap: 16px;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      }

      .support-form label {
        font-size: 0.9rem;
        color: #cbd5e1;
        display: grid;
        gap: 8px;
        font-weight: 500;
      }

      .support-form select,
      .support-form input,
      .support-form textarea {
        width: 100%;
        padding: 12px 14px;
        border-radius: 12px;
        border: 1px solid rgba(148, 163, 184, 0.3);
        background: rgba(15, 23, 42, 0.8);
        color: #e2e8f0;
        font-size: 0.95rem;
        font-family: inherit;
        transition: all 0.2s ease;
      }

      .support-form select:focus,
      .support-form input:focus,
      .support-form textarea:focus {
        outline: none;
        border-color: #38bdf8;
        box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.1);
      }

      .support-form textarea {
        min-height: 120px;
        resize: vertical;
      }

      .support-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 14px;
        align-items: center;
      }

      .support-helper {
        font-size: 0.85rem;
        color: #94a3b8;
        line-height: 1.5;
      }

      /* â”€â”€ Discount code field â”€â”€ */
      .discount-code-row {
        display: flex;
        gap: 10px;
        align-items: stretch;
      }

      .discount-code-row input {
        flex: 1;
      }

      .apply-code-btn {
        padding: 12px 18px;
        border-radius: 12px;
        border: 1px solid rgba(148, 163, 184, 0.4);
        background: transparent;
        color: #e2e8f0;
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        font-family: inherit;
        white-space: nowrap;
      }

      .apply-code-btn:hover {
        background: rgba(148, 163, 184, 0.1);
        border-color: rgba(148, 163, 184, 0.6);
      }

      .code-feedback {
        font-size: 0.85rem;
        margin-top: 6px;
        min-height: 18px;
        display: block;
      }

      .code-feedback.success { color: #4ade80; }
      .code-feedback.error   { color: #f87171; }

      /* â”€â”€ Secret code modal â”€â”€ */
      .secret-modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.55);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 10002;
        backdrop-filter: blur(4px);
      }

      .secret-modal-overlay.visible {
        display: flex;
      }

      .secret-modal-box {
        background: rgba(15, 23, 42, 0.98);
        border: 1px solid rgba(148, 163, 184, 0.3);
        border-radius: 18px;
        padding: 28px 28px 22px;
        width: min(360px, calc(100vw - 40px));
        box-shadow: 0 24px 70px rgba(0, 0, 0, 0.6);
        display: grid;
        gap: 14px;
      }

      .secret-modal-title {
        font-size: 1rem;
        font-weight: 600;
        color: #f8fafc;
        margin: 0;
      }

      .secret-modal-row {
        display: flex;
        gap: 10px;
      }

      .secret-modal-input {
        flex: 1;
        padding: 12px 14px;
        border-radius: 12px;
        border: 1px solid rgba(148, 163, 184, 0.3);
        background: rgba(15, 23, 42, 0.8);
        color: #e2e8f0;
        font-size: 0.95rem;
        font-family: inherit;
        outline: none;
        transition: border-color 0.2s;
      }

      .secret-modal-input:focus {
        border-color: #38bdf8;
        box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.1);
      }

      .secret-modal-cancel {
        background: none;
        border: none;
        color: #64748b;
        font-size: 0.85rem;
        cursor: pointer;
        padding: 4px 0;
        font-family: inherit;
        text-align: left;
        transition: color 0.2s;
      }

      .secret-modal-cancel:hover { color: #94a3b8; }

      /* â”€â”€ Customization panel â”€â”€ */
      .customize-panel {
        position: fixed;
        bottom: 24px;
        left: 24px;
        background: rgba(15, 23, 42, 0.97);
        border: 1px solid rgba(148, 163, 184, 0.3);
        border-radius: 20px;
        padding: 20px;
        width: 260px;
        z-index: 10001;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(12px);
        display: none;
        animation: fadeSlideIn 0.3s ease;
      }

      .customize-panel.visible {
        display: block;
      }

      .customize-panel h3 {
        font-size: 0.95rem;
        color: #f8fafc;
        font-weight: 600;
        margin-bottom: 14px;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .theme-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
      }

      .theme-btn {
        padding: 10px 12px;
        border-radius: 10px;
        border: 1px solid rgba(148, 163, 184, 0.25);
        background: rgba(30, 41, 59, 0.8);
        color: #cbd5e1;
        font-size: 0.8rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        font-family: inherit;
        text-align: center;
      }

      .theme-btn:hover,
      .theme-btn.active {
        border-color: #38bdf8;
        color: #38bdf8;
        background: rgba(56, 189, 248, 0.1);
      }

      .close-customize {
        background: none;
        border: none;
        color: #94a3b8;
        cursor: pointer;
        font-size: 1rem;
        padding: 0;
        line-height: 1;
      }

      .close-customize:hover { color: #e2e8f0; }

      .secret-code-trigger {
        background: none;
        border: none;
        color: #475569;
        cursor: pointer;
        font-size: 0.85rem;
        padding: 4px 6px;
        border-radius: 6px;
        transition: color 0.2s;
        font-family: inherit;
      }

      .secret-code-trigger:hover { color: #94a3b8; }

      /* â”€â”€ UI themes â”€â”€ */
      body.theme-ocean {
        background: radial-gradient(circle at top, #0d2137, #050f1a 65%);
      }
      body.theme-ocean main {
        background: rgba(5, 15, 26, 0.85);
        border-color: rgba(34, 211, 238, 0.2);
      }
      body.theme-forest {
        background: radial-gradient(circle at top, #0f2518, #060f0a 65%);
      }
      body.theme-forest main {
        background: rgba(6, 15, 10, 0.85);
        border-color: rgba(74, 222, 128, 0.2);
      }
      body.theme-sunset {
        background: radial-gradient(circle at top, #2d1515, #1a0a0a 65%);
      }
      body.theme-sunset main {
        background: rgba(26, 10, 10, 0.85);
        border-color: rgba(251, 146, 60, 0.2);
      }
      body.theme-minimal {
        background: #0a0a0a;
      }
      body.theme-minimal main {
        background: rgba(10, 10, 10, 0.95);
        border-color: rgba(255, 255, 255, 0.1);
        box-shadow: none;
      }

      .price-estimate {
        background: rgba(56, 189, 248, 0.08);
        border: 1px solid rgba(56, 189, 248, 0.25);
        border-radius: 10px;
        padding: 12px 16px;
        font-size: 0.9rem;
        color: #7dd3fc;
        font-weight: 500;
        display: none;
        animation: fadeSlideIn 0.3s ease;
      }

      @keyframes fadeSlideIn {
        from { opacity: 0; transform: translateY(6px); }
        to   { opacity: 1; transform: translateY(0); }
      }

      @media (max-width: 640px) {
        body {
          padding: 24px 16px;
        }
        main {
          padding: 40px 24px;
          gap: 32px;
        }
        h1 {
          font-size: 2rem;
        }
        .details {
          grid-template-columns: 1fr;
        }
        footer {
          flex-direction: column;
          align-items: flex-start;
          gap: 16px;
        }
        .language-switcher {
          top: 16px;
          right: 16px;
        }
      }
    </style>
  </head>
  <body>
    <div class="language-switcher">
      <button class="lang-btn active" data-lang="en" aria-label="Switch to English">
        EN
      </button>
      <button class="lang-btn" data-lang="de" aria-label="Switch to German">DE</button>
    </div>

    <div class="asset-loader" id="assetLoader" aria-live="polite">
      <div class="asset-top">
        <div class="asset-title">
          <strong data-i18n="loader.title">Loading assets</strong>
          <span id="assetSub" data-i18n="loader.initializing">Initializingâ€¦</span>
        </div>
        <div class="asset-actions">
          <button class="skip-btn" id="skipBtn" type="button" aria-label="Skip loading">
            <span data-i18n="loader.skip">Skip</span>
          </button>
          <div class="mini-spinner" aria-hidden="true"></div>
        </div>
      </div>

      <div
        class="asset-progress"
        role="progressbar"
        aria-valuemin="0"
        aria-valuemax="100"
        aria-valuenow="0"
      >
        <div id="assetBar"></div>
      </div>

      <div class="asset-detail">
        <span id="assetCount">0 / 8</span>
        <span class="asset-badge" id="assetBadge">0%</span>
      </div>
    </div>

    <main>
      <header>
        <span class="eyebrow" data-i18n="header.eyebrow">XMenu Home</span>
        <h1 data-i18n="header.title">Your next iPad experience starts with XMenu.</h1>
        <p data-i18n="header.description">
          Discover a modern platform that perfectly combines design and functionality.
          XMenu takes your iPad experience to the next level.
        </p>

        <div class="actions">
          <a
            class="button primary"
            id="downloadBtn"
            href="https://www.icloud.com/shortcuts/490d2848d8534f77bf4dbc6d6466af67"
            aria-label="Download XMenu"
          >
            <span data-i18n="header.download">Download</span>
          </a>
          <a class="button secondary" href="mailto:support@xmenu.dev" aria-label="Contact via email">
            <span data-i18n="header.contact">Contact</span>
          </a>
          <button class="button secondary" id="supportToggle" type="button" aria-label="Open tech support">
            <span data-i18n="header.support">Tech Support</span>
          </button>

          <a
            class="button secondary"
            id="accountBtn"
            href="https://accounts.xmenu.dev/?returnTo=https%3A%2F%2Fxmenu.dev%2F"
            aria-label="Login or register"
          >
            Login / Register
          </a>

          <a class="button secondary" id="releasesBtn" href="https://rls.xmenu.dev" aria-label="Releases">
            Releases
          </a>
        </div>

        <p id="signedInLabel" style="display: none; margin-top: 10px; color: #cbd5e1;"></p>
      </header>

      <section class="details">
        <div class="detail-card">
          <h2 data-i18n="features.design.title">Ready-to-go Design</h2>
          <p data-i18n="features.design.description">
            Modern layouts for a strong first impression and intuitive operation.
          </p>
        </div>
        <div class="detail-card">
          <h2 data-i18n="features.onboarding.title">Fast Onboarding</h2>
          <p data-i18n="features.onboarding.description">
            Simple setup, ready to use immediately â€“ without complicated configuration.
          </p>
        </div>
        <div class="detail-card">
          <h2 data-i18n="features.development.title">Continuous Development</h2>
          <p data-i18n="features.development.description">
            Regular updates and new features for the best user experience.
          </p>
        </div>
      </section>

      <section class="support-panel" id="supportPanel">
        <div>
          <h2 data-i18n="support.title">Tech Support Request</h2>
          <p data-i18n="support.description">
            Select your device type, brand and model, and describe your problem. The request
            will be sent via email to our support team.
          </p>
        </div>
        <form class="support-form" id="supportForm">
          <div class="support-grid">
            <label>
              <span data-i18n="support.deviceType">Device Type</span>
              <select name="deviceType" id="deviceTypeSelect" required>
                <option value="" disabled selected data-i18n="support.pleaseSelect">Please select</option>
                <option value="Phone">Phone / Smartphone</option>
                <option value="Laptop">Laptop</option>
                <option value="iPad">iPad / Tablet</option>
                <option value="Desktop">Desktop PC</option>
                <option value="iMac">iMac</option>
                <option value="MacBook">MacBook</option>
                <option value="Smartwatch">Smartwatch</option>
                <option value="Smart TV">Smart TV</option>
                <option value="Gaming Console">Gaming Console</option>
                <option value="Other">Other Device</option>
              </select>
            </label>
            <label>
              <span data-i18n="support.brand">Brand</span>
              <input
                name="brand"
                data-i18n-placeholder="support.brandPlaceholder"
                placeholder="e.g. Apple, Samsung, Dell"
                required
              />
            </label>
            <label>
              <span data-i18n="support.model">Model</span>
              <input
                name="model"
                data-i18n-placeholder="support.modelPlaceholder"
                placeholder="e.g. iPhone 14, XPS 13"
                required
              />
            </label>
          </div>
          <label>
            <span data-i18n="support.issue">Describe your problem</span>
            <textarea
              name="issue"
              id="issueTextarea"
              data-i18n-placeholder="support.issuePlaceholder"
              placeholder="Brief description of the problemâ€¦"
              required
            ></textarea>
          </label>
          <div id="priceEstimate" class="price-estimate"></div>
          <label>
            <span data-i18n="support.discountCode">Discount Code (optional)</span>
            <div class="discount-code-row">
              <input
                name="discountCode"
                id="discountCodeInput"
                data-i18n-placeholder="support.discountCodePlaceholder"
                placeholder="Enter code (e.g. 2026Xrepairpro)"
                autocomplete="off"
              />
              <button class="apply-code-btn" type="button" id="applyCodeBtn">
                <span data-i18n="support.applyCode">Apply</span>
              </button>
            </div>
            <span class="code-feedback" id="codeFeedback"></span>
          </label>
          <div class="support-actions">
            <button class="button primary" type="submit">
              <span data-i18n="support.submit">Request Support</span>
            </button>
            <span class="support-helper" data-i18n="support.helper">
              Your email program will open with the pre-filled message.
            </span>
          </div>
        </form>
      </section>

      <footer>
        <div class="footer-note">
          <span class="pill" data-i18n="footer.comingSoon">Coming Soon</span>
          <span data-i18n="footer.patch">Patch 1.2.7</span>
        </div>
        <span data-i18n="footer.contact">Contact: support@xmenu.dev</span>
        <button class="secret-code-trigger" id="secretCodeTrigger" type="button" title="Enter a secret code">ðŸ”‘</button>
      </footer>
    </main>

    <div class="secret-modal-overlay" id="secretCodeModal" role="dialog" aria-modal="true" aria-label="Enter secret code">
      <div class="secret-modal-box">
        <p class="secret-modal-title">Enter secret code</p>
        <div class="secret-modal-row">
          <input type="text" id="secretModalInput" class="secret-modal-input" placeholder="Secret codeâ€¦" autocomplete="off" />
          <button class="apply-code-btn" id="secretModalSubmit" type="button">Unlock</button>
        </div>
        <button class="secret-modal-cancel" id="secretModalClose" type="button">Cancel</button>
      </div>
    </div>

    <div class="customize-panel" id="customizePanel" aria-label="Theme customization">
      <h3>
        ðŸŽ¨ Themes
        <button class="close-customize" id="closeCustomize" type="button" aria-label="Close customization panel">âœ•</button>
      </h3>
      <div class="theme-grid">
        <button class="theme-btn active" data-theme="default">Default</button>
        <button class="theme-btn" data-theme="ocean">Ocean</button>
        <button class="theme-btn" data-theme="forest">Forest</button>
        <button class="theme-btn" data-theme="sunset">Sunset</button>
        <button class="theme-btn" data-theme="minimal">Minimal</button>
      </div>
    </div>

    <script>
      // Translation data
      const translations = {
        en: {
          loader: {
            title: "Loading assets",
            initializing: "Initializingâ€¦",
            loading: "Loading: {asset}â€¦",
            done: "Done.",
            skip: "Skip"
          },
          header: {
            eyebrow: "XMenu Home",
            title: "Your next iPad experience starts with XMenu.",
            description:
              "Discover a modern platform that perfectly combines design and functionality. XMenu takes your iPad experience to the next level.",
            download: "Download",
            contact: "Contact",
            support: "Tech Support",
            supportClose: "Close"
          },
          features: {
            design: {
              title: "Ready-to-go Design",
              description:
                "Modern layouts for a strong first impression and intuitive operation."
            },
            onboarding: {
              title: "Fast Onboarding",
              description:
                "Simple setup, ready to use immediately â€“ without complicated configuration."
            },
            development: {
              title: "Continuous Development",
              description:
                "Regular updates and new features for the best user experience."
            }
          },
          support: {
            title: "Tech Support Request",
            description:
              "Select your device type, brand and model, and describe your problem. The request will be sent via email to our support team.",
            deviceType: "Device Type",
            pleaseSelect: "Please select",
            brand: "Brand",
            brandPlaceholder: "e.g. Apple, Samsung, Dell",
            model: "Model",
            modelPlaceholder: "e.g. iPhone 14, XPS 13",
            issue: "Describe your problem",
            issuePlaceholder: "Brief description of the problemâ€¦",
            submit: "Request Support",
            helper: "A security check is required before sending. Your email client will then open.",
            discountCode: "Discount Code (optional)",
            discountCodePlaceholder: "Enter code (e.g. 2026Xrepairpro)",
            applyCode: "Apply",
            codeApplied: "âœ“ Code applied: {discount}% Discount",
            codeInvalid: "âœ— Invalid code",
            codeUnlocked: "âœ“ Customization panel unlocked!",
            pricePhone: "ðŸ“ž Estimated cost: from 2.50 â‚¬ (phone support)",
            priceStorage: "ðŸ’¾ Estimated cost: from 40 â‚¬ (storage repair)",
            priceOther: "ðŸ”§ Estimated cost: 2 â‚¬ â€“ 100 â‚¬ (general repair)"
          },
          footer: {
            comingSoon: "Coming Soon",
            patch: "Patch 1.2.7",
            contact: "Contact: support@xmenu.dev"
          },
          assets: [
            "Styles",
            "Fonts",
            "Layout",
            "Icons",
            "Images",
            "Configuration",
            "Components",
            "Footer"
          ]
        },
        de: {
          loader: {
            title: "Assets werden geladen",
            initializing: "Initialisierungâ€¦",
            loading: "Lade: {asset}â€¦",
            done: "Fertig.",
            skip: "Ãœberspringen"
          },
          header: {
            eyebrow: "XMenu Hauptseite",
            title: "Dein nÃ¤chstes iPad Erlebnis beginnt mit XMenu.",
            description:
              "Entdecke eine moderne Plattform, die Design und FunktionalitÃ¤t perfekt vereint. Mit XMenu wird dein iPad-Erlebnis auf ein neues Level gehoben.",
            download: "Download",
            contact: "Kontakt",
            support: "Tech Support",
            supportClose: "SchlieÃŸen"
          },
          features: {
            design: {
              title: "Startklar im Design",
              description:
                "Moderne Layouts fÃ¼r einen starken ersten Eindruck und intuitive Bedienung."
            },
            onboarding: {
              title: "Schnelles Onboarding",
              description:
                "Einfache Einrichtung, sofort einsatzbereit â€“ ohne komplizierte Konfiguration."
            },
            development: {
              title: "StÃ¤ndige Weiterentwicklung",
              description:
                "RegelmÃ¤ÃŸige Updates und neue Funktionen fÃ¼r das beste Nutzererlebnis."
            }
          },
          support: {
            title: "Tech Support Anfrage",
            description:
              "WÃ¤hle deinen GerÃ¤tetyp, Marke und Modell aus und beschreibe dein Problem. Die Anfrage wird per E-Mail an unser Support-Team gesendet.",
            deviceType: "GerÃ¤tetyp",
            pleaseSelect: "Bitte wÃ¤hlen",
            brand: "Marke",
            brandPlaceholder: "z. B. Apple, Samsung, Dell",
            model: "Modell",
            modelPlaceholder: "z. B. iPhone 14, XPS 13",
            issue: "Beschreibe dein Problem",
            issuePlaceholder: "Kurze Beschreibung des Problemsâ€¦",
            submit: "Support anfragen",
            helper:
              "Eine SicherheitsprÃ¼fung ist erforderlich. Danach Ã¶ffnet sich dein E-Mail-Programm.",
            discountCode: "Rabattcode (optional)",
            discountCodePlaceholder: "Code eingeben (z. B. 2026Xrepairpro)",
            applyCode: "Anwenden",
            codeApplied: "âœ“ Code angewendet: {discount}% Rabatt",
            codeInvalid: "âœ— UngÃ¼ltiger Code",
            codeUnlocked: "âœ“ Anpassungsbereich freigeschaltet!",
            pricePhone: "ðŸ“ž GeschÃ¤tzte Kosten: ab 2,50 â‚¬ (Telefon-Support)",
            priceStorage: "ðŸ’¾ GeschÃ¤tzte Kosten: ab 40 â‚¬ (Speicher-Reparatur)",
            priceOther: "ðŸ”§ GeschÃ¤tzte Kosten: 2 â‚¬ â€“ 100 â‚¬ (allgemeine Reparatur)"
          },
          footer: {
            comingSoon: "DemnÃ¤chst verfÃ¼gbar",
            patch: "Patch 1.2.9",
            contact: "Kontakt: support@xmenu.dev"
          },
          assets: [
            "Styles",
            "Schriften",
            "Layout",
            "Icons",
            "Bilder",
            "Konfiguration",
            "Komponenten",
            "Footer"
          ]
        }
      };

      let currentLang = localStorage.getItem("xmenu-lang") || "de";
      let currentAssets = translations[currentLang].assets;

      function setLanguage(lang) {
        currentLang = translations[lang] ? lang : "en";
        currentAssets = translations[currentLang].assets;
        document.documentElement.lang = currentLang;

        document.querySelectorAll("[data-i18n]").forEach((element) => {
          const key = element.getAttribute("data-i18n");
          const keys = key.split(".");
          let value = translations[currentLang];
          for (const k of keys) value = value?.[k];
          if (typeof value === "string") element.textContent = value;
        });

        document.querySelectorAll("[data-i18n-placeholder]").forEach((element) => {
          const key = element.getAttribute("data-i18n-placeholder");
          const keys = key.split(".");
          let value = translations[currentLang];
          for (const k of keys) value = value?.[k];
          if (typeof value === "string") element.placeholder = value;
        });

        document.querySelectorAll(".lang-btn").forEach((btn) => {
          btn.classList.toggle("active", btn.getAttribute("data-lang") === currentLang);
        });

        localStorage.setItem("xmenu-lang", currentLang);
      }

      document.querySelectorAll(".lang-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          const lang = btn.getAttribute("data-lang");
          setLanguage(lang);
          if (!done) render();
        });
      });

      const loader = document.getElementById("assetLoader");
      const sub = document.getElementById("assetSub");
      const bar = document.getElementById("assetBar");
      const count = document.getElementById("assetCount");
      const badge = document.getElementById("assetBadge");
      const skipBtn = document.getElementById("skipBtn");
      const progressBar = loader.querySelector(".asset-progress");

      const supportToggle = document.getElementById("supportToggle");
      const downloadBtn = document.getElementById("downloadBtn");
      const supportPanel = document.getElementById("supportPanel");
      const supportForm = document.getElementById("supportForm");
      const deviceTypeSelect = document.getElementById("deviceTypeSelect");
      const issueTextarea = document.getElementById("issueTextarea");
      const priceEstimate = document.getElementById("priceEstimate");

      const loginRedirectUrl =
        "https://accounts.xmenu.dev/?returnTo=" + encodeURIComponent(window.location.href);

      window.xmenuRequireAuth =
        window.xmenuRequireAuth ||
        (async () => {
          window.location.href = loginRedirectUrl;
          return false;
        });

      let index = 0;
      let done = false;
      let timerId = null;

      const getTotal = () => (Array.isArray(currentAssets) ? currentAssets.length : 0);

      const render = () => {
        const total = getTotal();
        const loaded = Math.min(index, total);
        const pct = total === 0 ? 100 : Math.round((loaded / total) * 100);

        count.textContent = `${loaded} / ${total}`;
        badge.textContent = `${pct}%`;
        bar.style.width = `${pct}%`;
        progressBar.setAttribute("aria-valuenow", String(pct));

        const t = translations[currentLang];

        if (!done && loaded < total) {
          const assetName = currentAssets[loaded] ?? "";
          sub.textContent = t.loader.loading.replace("{asset}", assetName);
        } else {
          sub.textContent = t.loader.done;
        }
      };

      const finish = () => {
        if (done) return;
        done = true;
        index = getTotal();
        render();
        setTimeout(() => loader.classList.add("hidden"), 400);
      };

      const start = () => {
        render();
        if (getTotal() === 0) return finish();

        timerId = setInterval(() => {
          index += 1;
          render();
          if (index >= getTotal()) {
            clearInterval(timerId);
            finish();
          }
        }, 500);
      };

      skipBtn.addEventListener("click", () => {
        if (timerId) clearInterval(timerId);
        finish();
      });

      const toggleSupportPanel = () => {
        const isOpen = supportPanel.classList.contains("support-panel--open");
        const t = translations[currentLang];

        if (!isOpen) {
          supportPanel.classList.add("support-panel--open");
          supportToggle.querySelector("[data-i18n]").textContent = t.header.supportClose;
          setTimeout(() => {
            supportPanel.scrollIntoView({ behavior: "smooth", block: "start" });
          }, 10);
        } else {
          supportPanel.classList.remove("support-panel--open");
          supportToggle.querySelector("[data-i18n]").textContent = t.header.support;
        }
      };

      // â”€â”€ Price Estimate â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      const STORAGE_KEYWORDS = ["storage", "disk", "ssd", "hdd", "speicher", "festplatte", "laufwerk", "flash", "memory"];
      const PHONE_KEYWORDS   = ["phone", "handy", "smartphone", "mobil"];

      function updatePriceEstimate() {
        const issue      = (issueTextarea.value || "").toLowerCase();
        const deviceType = (deviceTypeSelect.value || "").toLowerCase();
        const t          = translations[currentLang];

        const hasPhone   = PHONE_KEYWORDS.some(k => issue.includes(k)) || deviceType === "phone";
        const hasStorage = STORAGE_KEYWORDS.some(k => issue.includes(k));

        let label = "";
        if (hasPhone) {
          label = t.support.pricePhone;
        } else if (hasStorage) {
          label = t.support.priceStorage;
        } else if (issue.trim().length > 10) {
          label = t.support.priceOther;
        }

        if (label) {
          priceEstimate.textContent = label;
          priceEstimate.style.display = "block";
          // Restart the CSS animation: first reset it, then force a synchronous
          // reflow (reading offsetHeight flushes the style change), then re-enable.
          priceEstimate.style.animation = "none";
          void priceEstimate.offsetHeight; // forces browser reflow to restart animation
          priceEstimate.style.animation = "";
        } else {
          priceEstimate.style.display = "none";
        }
      }

      issueTextarea.addEventListener("input", updatePriceEstimate);
      deviceTypeSelect.addEventListener("change", updatePriceEstimate);

      // â”€â”€ Discount & Secret Codes â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      const DISCOUNT_CODES = {
        "2026xrepairpro": { discount: 10 }
      };

      const SECRET_UI_CODES = {
        "customization": { action: "theme_panel" },
        "nightpro":      { action: "theme_panel" }
      };

      let appliedCode     = null;
      let appliedDiscount = 0;

      const discountCodeInput = document.getElementById("discountCodeInput");
      const applyCodeBtn      = document.getElementById("applyCodeBtn");
      const codeFeedback      = document.getElementById("codeFeedback");

      function applyDiscountCode() {
        const raw        = (discountCodeInput.value || "").trim();
        const normalized = raw.toLowerCase();
        const t          = translations[currentLang];

        // Check secret UI codes first
        if (SECRET_UI_CODES[normalized]) {
          const action = SECRET_UI_CODES[normalized].action;
          if (action === "theme_panel") {
            document.getElementById("customizePanel").classList.add("visible");
            codeFeedback.textContent = t.support.codeUnlocked;
            codeFeedback.className   = "code-feedback success";
            discountCodeInput.value  = "";
          }
          return;
        }

        // Check discount codes
        if (DISCOUNT_CODES[normalized]) {
          appliedCode     = raw;
          appliedDiscount = DISCOUNT_CODES[normalized].discount;
          codeFeedback.textContent = t.support.codeApplied.replace("{discount}", appliedDiscount);
          codeFeedback.className   = "code-feedback success";
        } else if (raw.length > 0) {
          appliedCode     = null;
          appliedDiscount = 0;
          codeFeedback.textContent = t.support.codeInvalid;
          codeFeedback.className   = "code-feedback error";
        } else {
          appliedCode     = null;
          appliedDiscount = 0;
          codeFeedback.textContent = "";
          codeFeedback.className   = "code-feedback";
        }
      }

      applyCodeBtn.addEventListener("click", applyDiscountCode);
      discountCodeInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") { e.preventDefault(); applyDiscountCode(); }
      });

      // Secret code trigger (ðŸ”‘ button in footer) â€“ opens inline modal
      const secretCodeTrigger = document.getElementById("secretCodeTrigger");
      const secretModal        = document.getElementById("secretCodeModal");
      const secretModalInput   = document.getElementById("secretModalInput");
      const secretModalSubmit  = document.getElementById("secretModalSubmit");
      const secretModalClose   = document.getElementById("secretModalClose");

      function submitSecretModal() {
        const normalized = (secretModalInput.value || "").trim().toLowerCase();
        secretModal.classList.remove("visible");
        secretModalInput.value = "";
        if (SECRET_UI_CODES[normalized]) {
          const action = SECRET_UI_CODES[normalized].action;
          if (action === "theme_panel") {
            document.getElementById("customizePanel").classList.add("visible");
          }
        }
      }

      secretCodeTrigger.addEventListener("click", () => {
        secretModal.classList.add("visible");
        secretModalInput.focus();
      });
      secretModalSubmit.addEventListener("click", submitSecretModal);
      secretModalClose.addEventListener("click", () => {
        secretModal.classList.remove("visible");
        secretModalInput.value = "";
      });
      secretModalInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") submitSecretModal();
        if (e.key === "Escape") { secretModal.classList.remove("visible"); secretModalInput.value = ""; }
      });

      // Customization panel
      const customizePanel = document.getElementById("customizePanel");
      document.getElementById("closeCustomize").addEventListener("click", () => {
        customizePanel.classList.remove("visible");
      });

      const ALL_THEMES = ["ocean", "forest", "sunset", "minimal"];

      function applyTheme(theme) {
        ALL_THEMES.forEach(t => document.body.classList.remove("theme-" + t));
        if (theme !== "default") {
          document.body.classList.add("theme-" + theme);
        }
        document.querySelectorAll(".theme-btn").forEach(b => b.classList.remove("active"));
        const activeBtn = document.querySelector('.theme-btn[data-theme="' + theme + '"]');
        if (activeBtn) activeBtn.classList.add("active");
        localStorage.setItem("xmenu-theme", theme);
      }

      document.querySelectorAll(".theme-btn").forEach(btn => {
        btn.addEventListener("click", () => applyTheme(btn.getAttribute("data-theme")));
      });

      // Restore saved theme on load
      const savedTheme = localStorage.getItem("xmenu-theme");
      if (savedTheme) applyTheme(savedTheme);

      supportToggle.addEventListener("click", async () => {
        const canAccess = await window.xmenuRequireAuth();
        if (!canAccess) return;
        toggleSupportPanel();
      });

      downloadBtn.addEventListener("click", async (event) => {
        event.preventDefault();
        const canAccess = await window.xmenuRequireAuth();
        if (!canAccess) return;
        window.location.href = downloadBtn.href;
      });

      supportForm.addEventListener("submit", (event) => {
        event.preventDefault();

        const formData = new FormData(supportForm);

        const deviceType = String(formData.get("deviceType") || "");
        const brand      = String(formData.get("brand")      || "");
        const model      = String(formData.get("model")      || "");
        const issue      = String(formData.get("issue")      || "");

        // Persist form data for after the security check
        let dataSaved = false;
        try {
          sessionStorage.setItem("xmenu_support_data", JSON.stringify({
            deviceType, brand, model, issue, lang: currentLang,
            discountCode: appliedCode || "",
            discountPct:  appliedDiscount
          }));
          dataSaved = true;
        } catch (e) { /* storage unavailable */ }

        if (!dataSaved) {
          alert("Unable to save your form data (storage unavailable). Please disable private browsing or try a different browser, then resubmit.");
          return;
        }

        // Redirect to security check; on return the action param triggers the mailto
        const returnTo = window.location.origin + window.location.pathname + "?action=send_support";
        window.location.href = "security.html?returnTo=" + encodeURIComponent(returnTo);
      });

      const savedLang = localStorage.getItem("xmenu-lang") || "en";
      setLanguage(savedLang);

      // â”€â”€ Handle pending support send (return from security check) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      (function handlePendingSupportAction() {
        const params = new URLSearchParams(window.location.search);
        if (params.get("action") !== "send_support") return;

        // Clean action param from URL
        params.delete("action");
        const cleanSearch = params.toString();
        const cleanUrl = window.location.origin + window.location.pathname + (cleanSearch ? "?" + cleanSearch : "");
        window.history.replaceState({}, document.title, cleanUrl);

        try {
          const saved = sessionStorage.getItem("xmenu_support_data");
          if (!saved) {
            alert("Your support request data could not be retrieved. Please fill out and submit the form again.");
            return;
          }
          sessionStorage.removeItem("xmenu_support_data");

          const { deviceType, brand, model, issue, lang, discountCode, discountPct } = JSON.parse(saved);
          const tData = translations[lang] || translations[currentLang];

          const subject = encodeURIComponent(`Tech Support: ${deviceType} - ${brand} ${model}`.trim());
          const bodyLines = [
            `${tData.support.deviceType}: ${deviceType}`,
            `${tData.support.brand}: ${brand}`,
            `${tData.support.model}: ${model}`,
            "",
            issue
          ];
          if (discountCode) {
            bodyLines.push("");
            bodyLines.push(`Used code: ${discountCode} | Discount: ${discountPct}%`);
          }
          const body = encodeURIComponent(bodyLines.join("\n"));
          window.location.href = `mailto:support@xmenu.dev?subject=${subject}&body=${body}`;
        } catch (e) {
          alert("Your support request data could not be retrieved. Please fill out and submit the form again.");
        }
      })();

      start();
    </script>

    <script type="module">
      import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

      const SUPABASE_URL = "https://miivgganhzzqfzebmaxx.supabase.co";
      const SUPABASE_ANON_KEY =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1paXZnZ2FuaHp6cWZ6ZWJtYXh4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAyOTg0OTYsImV4cCI6MjA4NTg3NDQ5Nn0.WAB1I8f8B46WzgvTqNn_jFiMBUb-63LPtCpCMrAkCoY";

      const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      const label = document.getElementById("signedInLabel");
      const accountBtn = document.getElementById("accountBtn");

      async function ensureProfileRow(userId) {
        const { data } = await supabase
          .from("profiles")
          .select("user_id")
          .eq("user_id", userId)
          .maybeSingle();

        if (data) return;
        await supabase.from("profiles").insert({ user_id: userId, display_name: "" });
      }

      async function renderAccount() {
        const { data } = await supabase.auth.getUser();
        const user = data.user;

        window.xmenuRequireAuth = async () => {
          const { data: authData } = await supabase.auth.getUser();
          if (authData.user) return true;
          window.location.href =
            "https://accounts.xmenu.dev/?returnTo=" +
            encodeURIComponent(window.location.href);
          return false;
        };

        if (!user) {
          label.style.display = "none";
          accountBtn.textContent = "Login / Register";
          accountBtn.href =
            "https://accounts.xmenu.dev/?returnTo=" +
            encodeURIComponent("https://xmenu.dev/");
          return;
        }

        await ensureProfileRow(user.id);

        const { data: profile } = await supabase
          .from("profiles")
          .select("display_name")
          .eq("user_id", user.id)
          .maybeSingle();

        const name = (profile?.display_name || "").trim() || user.email || "User";

        label.textContent = "Signed in as: " + name;
        label.style.display = "block";

        accountBtn.textContent = "Account Settings";
        accountBtn.href =
          "https://accounts.xmenu.dev/?returnTo=" +
          encodeURIComponent("https://xmenu.dev/");
      }

      supabase.auth.onAuthStateChange(() => {
        renderAccount();
      });

      renderAccount();
    </script>
  </body>
</html>
