<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Security Verification - XMenu</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        color-scheme: dark;
        font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background-color: #0f172a;
        color: #e2e8f0;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        margin: 0;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: radial-gradient(circle at top, #1e293b, #0f172a 65%);
        padding: 48px 20px;
      }

      /* â”€â”€ Pre-check overlay â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      .precheck-overlay {
        position: fixed;
        inset: 0;
        background: radial-gradient(circle at top, #1e293b, #0f172a 65%);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 200;
        transition: opacity 0.5s ease, transform 0.5s ease;
      }

      .precheck-overlay.fade-out {
        opacity: 0;
        transform: scale(0.97);
        pointer-events: none;
      }

      .precheck-card {
        text-align: center;
        padding: 48px clamp(24px, 6vw, 64px);
        background: rgba(15, 23, 42, 0.9);
        border: 1px solid rgba(148, 163, 184, 0.2);
        border-radius: 28px;
        width: min(480px, 90%);
        box-shadow: 0 30px 80px rgba(15, 23, 42, 0.55);
        backdrop-filter: blur(12px);
        animation: slideUpIn 0.55s cubic-bezier(0.22, 1, 0.36, 1) both;
      }

      @keyframes slideUpIn {
        from { opacity: 0; transform: translateY(32px) scale(0.97); }
        to   { opacity: 1; transform: translateY(0)   scale(1);    }
      }

      .precheck-icon {
        font-size: 3.2rem;
        line-height: 1;
        margin-bottom: 20px;
        display: block;
        animation: iconPulse 2.4s ease-in-out infinite;
      }

      @keyframes iconPulse {
        0%, 100% { transform: scale(1);    filter: drop-shadow(0 0 0px #3b82f6); }
        50%       { transform: scale(1.12); filter: drop-shadow(0 0 12px #3b82f6); }
      }

      .precheck-title {
        font-size: clamp(1.5rem, 4vw, 2rem);
        font-weight: 700;
        color: #f8fafc;
        margin-bottom: 10px;
        letter-spacing: -0.02em;
      }

      .precheck-sub {
        font-size: 0.95rem;
        color: #94a3b8;
        line-height: 1.6;
        margin-bottom: 28px;
      }

      /* SVG countdown ring */
      .countdown-wrap {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 28px;
        position: relative;
        width: 80px;
        height: 80px;
        margin-left: auto;
        margin-right: auto;
      }

      .countdown-svg {
        transform: rotate(-90deg);
      }

      .countdown-track {
        fill: none;
        stroke: rgba(148, 163, 184, 0.15);
        stroke-width: 5;
      }

      .countdown-progress {
        fill: none;
        stroke: #3b82f6;
        stroke-width: 5;
        stroke-linecap: round;
        stroke-dasharray: 220;
        stroke-dashoffset: 0;
        transition: stroke-dashoffset 1s linear;
        filter: drop-shadow(0 0 4px rgba(59, 130, 246, 0.6));
      }

      .countdown-number {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.6rem;
        font-weight: 700;
        color: #f8fafc;
      }

      /* Skip button */
      .skip-btn {
        padding: 11px 26px;
        background: rgba(148, 163, 184, 0.08);
        color: #94a3b8;
        border: 1px solid rgba(148, 163, 184, 0.2);
        border-radius: 999px;
        font-size: 0.9rem;
        font-weight: 600;
        font-family: inherit;
        cursor: pointer;
        transition: background 0.2s ease, color 0.2s ease, transform 0.15s ease,
                    box-shadow 0.2s ease;
      }

      .skip-btn:hover {
        background: rgba(148, 163, 184, 0.16);
        color: #cbd5e1;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
      }

      .skip-btn:active {
        transform: translateY(0);
      }

      /* â”€â”€ Code-bypass modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      .code-modal-backdrop {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.65);
        backdrop-filter: blur(6px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 300;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
      }

      .code-modal-backdrop.show {
        opacity: 1;
        pointer-events: auto;
      }

      .code-modal {
        background: rgba(15, 23, 42, 0.96);
        border: 1px solid rgba(148, 163, 184, 0.25);
        border-radius: 20px;
        padding: 40px clamp(24px, 5vw, 48px);
        width: min(400px, 90%);
        box-shadow: 0 30px 80px rgba(0, 0, 0, 0.5);
        text-align: center;
        transform: translateY(20px) scale(0.97);
        transition: transform 0.3s cubic-bezier(0.22, 1, 0.36, 1);
      }

      .code-modal-backdrop.show .code-modal {
        transform: translateY(0) scale(1);
      }

      .code-modal h2 {
        font-size: 1.4rem;
        font-weight: 700;
        color: #f8fafc;
        margin-bottom: 10px;
      }

      .code-modal p {
        font-size: 0.9rem;
        color: #94a3b8;
        margin-bottom: 20px;
        line-height: 1.5;
      }

      .code-input {
        width: 100%;
        padding: 12px 16px;
        background: rgba(30, 41, 59, 0.7);
        border: 1px solid rgba(148, 163, 184, 0.3);
        border-radius: 10px;
        color: #e2e8f0;
        font-size: 1.2rem;
        font-family: inherit;
        font-weight: 600;
        letter-spacing: 0.2em;
        text-align: center;
        transition: border-color 0.2s ease, box-shadow 0.2s ease;
        margin-bottom: 12px;
      }

      .code-input:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
      }

      .code-error {
        font-size: 0.85rem;
        color: #fca5a5;
        margin-bottom: 16px;
        min-height: 20px;
        transition: opacity 0.2s ease;
      }

      .code-submit-btn {
        width: 100%;
        padding: 12px 24px;
        background: linear-gradient(135deg, #3b82f6, #2563eb);
        color: white;
        border: none;
        border-radius: 999px;
        font-size: 0.95rem;
        font-weight: 600;
        font-family: inherit;
        cursor: pointer;
        transition: transform 0.15s ease, box-shadow 0.2s ease;
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        margin-bottom: 10px;
      }

      .code-submit-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 6px 16px rgba(59, 130, 246, 0.45);
      }

      .code-submit-btn:active {
        transform: translateY(0);
      }

      .code-cancel-btn {
        background: none;
        border: none;
        color: #64748b;
        font-size: 0.85rem;
        font-family: inherit;
        cursor: pointer;
        padding: 4px 8px;
        transition: color 0.2s ease;
      }

      .code-cancel-btn:hover {
        color: #94a3b8;
      }

      /* â”€â”€ Main security form â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      .container {
        width: min(600px, 100%);
        background: rgba(15, 23, 42, 0.85);
        border: 1px solid rgba(148, 163, 184, 0.2);
        border-radius: 28px;
        padding: 56px clamp(24px, 5vw, 64px);
        box-shadow: 0 30px 80px rgba(15, 23, 42, 0.45);
        backdrop-filter: blur(10px);
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.5s ease, transform 0.5s cubic-bezier(0.22, 1, 0.36, 1);
      }

      .container.visible {
        opacity: 1;
        transform: translateY(0);
      }

      h1 {
        margin: 0 0 16px;
        font-size: clamp(1.8rem, 4vw, 2.4rem);
        color: #f8fafc;
        font-weight: 700;
        line-height: 1.2;
      }

      .subtitle {
        margin: 0 0 32px;
        font-size: 1rem;
        color: #cbd5e1;
        line-height: 1.6;
      }

      .question {
        margin-bottom: 24px;
        padding: 20px;
        background: rgba(30, 41, 59, 0.5);
        border-radius: 12px;
        border: 1px solid rgba(148, 163, 184, 0.15);
        transition: border-color 0.2s ease, background 0.2s ease;
      }

      .question:focus-within {
        border-color: rgba(59, 130, 246, 0.35);
        background: rgba(30, 41, 59, 0.7);
      }

      .question-label {
        display: block;
        margin-bottom: 12px;
        font-size: 0.95rem;
        color: #f8fafc;
        font-weight: 600;
      }

      .question-input {
        width: 100%;
        padding: 12px 16px;
        background: rgba(15, 23, 42, 0.7);
        border: 1px solid rgba(148, 163, 184, 0.3);
        border-radius: 8px;
        color: #e2e8f0;
        font-size: 0.95rem;
        font-family: inherit;
        transition: all 0.2s ease;
      }

      .question-input:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }

      .question-input::placeholder {
        color: #64748b;
      }

      .submit-btn {
        width: 100%;
        padding: 14px 28px;
        background: linear-gradient(135deg, #3b82f6, #2563eb);
        color: white;
        border: none;
        border-radius: 999px;
        font-size: 0.95rem;
        font-weight: 600;
        font-family: inherit;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
      }

      .submit-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4);
      }

      .submit-btn:active {
        transform: translateY(0);
      }

      .error-message {
        margin-top: 16px;
        padding: 12px 16px;
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.3);
        border-radius: 8px;
        color: #fca5a5;
        font-size: 0.9rem;
        display: none;
        animation: fadeIn 0.3s ease;
      }

      .error-message.show {
        display: block;
      }

      .info-box {
        margin-bottom: 24px;
        padding: 16px;
        background: rgba(59, 130, 246, 0.1);
        border: 1px solid rgba(59, 130, 246, 0.3);
        border-radius: 12px;
        color: #93c5fd;
        font-size: 0.9rem;
        line-height: 1.6;
      }

      .loader {
        display: none;
        text-align: center;
        margin-top: 16px;
      }

      .loader.show {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }

      .spinner {
        width: 18px;
        height: 18px;
        border: 2px solid rgba(148, 163, 184, 0.2);
        border-top-color: #3b82f6;
        border-radius: 50%;
        animation: spin 0.7s linear infinite;
        flex-shrink: 0;
      }

      @keyframes spin {
        to { transform: rotate(360deg); }
      }

      .loader-text {
        color: #94a3b8;
        font-size: 0.9rem;
      }

      .attempts-warning {
        margin-top: 16px;
        padding: 12px 16px;
        background: rgba(251, 191, 36, 0.1);
        border: 1px solid rgba(251, 191, 36, 0.3);
        border-radius: 8px;
        color: #fcd34d;
        font-size: 0.9rem;
        display: none;
      }

      .attempts-warning.show {
        display: block;
      }

      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-4px); }
        to   { opacity: 1; transform: translateY(0);    }
      }

      /* â”€â”€ Access-granted flash â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
      .granted-overlay {
        position: fixed;
        inset: 0;
        background: rgba(16, 185, 129, 0.12);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 400;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.4s ease;
      }

      .granted-overlay.show {
        opacity: 1;
      }

      .granted-card {
        text-align: center;
        background: rgba(15, 23, 42, 0.97);
        border: 1px solid rgba(16, 185, 129, 0.4);
        border-radius: 20px;
        padding: 40px 48px;
        box-shadow: 0 30px 80px rgba(0, 0, 0, 0.5),
                    0 0 40px rgba(16, 185, 129, 0.15);
        animation: popIn 0.45s cubic-bezier(0.22, 1, 0.36, 1) both;
      }

      @keyframes popIn {
        from { transform: scale(0.85); opacity: 0; }
        to   { transform: scale(1);    opacity: 1; }
      }

      .granted-icon {
        font-size: 3rem;
        display: block;
        margin-bottom: 12px;
      }

      .granted-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #10b981;
      }
    </style>
  </head>
  <body>
    <!-- â”€â”€ Pre-check 3-second announcement overlay â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="precheck-overlay" id="precheckOverlay">
      <div class="precheck-card">
        <span class="precheck-icon">ğŸ”’</span>
        <h2 class="precheck-title">Quick Security Check</h2>
        <p class="precheck-sub">We'll verify you're human in just a moment.</p>

        <div class="countdown-wrap">
          <svg class="countdown-svg" width="80" height="80" viewBox="0 0 80 80">
            <circle class="countdown-track" cx="40" cy="40" r="35"/>
            <circle class="countdown-progress" id="countdownRing" cx="40" cy="40" r="35"/>
          </svg>
          <div class="countdown-number" id="countdownNum">3</div>
        </div>

        <button type="button" class="skip-btn" id="skipBtn">
          Skip security check
        </button>
      </div>
    </div>

    <!-- â”€â”€ Bypass-code modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="code-modal-backdrop" id="codeModalBackdrop" role="dialog" aria-modal="true" aria-labelledby="codeModalTitle">
      <div class="code-modal">
        <h2 id="codeModalTitle">ğŸ”‘ Enter Access Code</h2>
        <p>Enter your access code to skip the security check.</p>
        <input
          type="text"
          class="code-input"
          id="codeInput"
          placeholder="Â·Â·Â·Â·"
          maxlength="10"
          autocomplete="off"
          inputmode="numeric"
        />
        <div class="code-error" id="codeError"></div>
        <button type="button" class="code-submit-btn" id="codeSubmitBtn">Verify Code</button>
        <br/>
        <button type="button" class="code-cancel-btn" id="codeCancelBtn">Cancel</button>
      </div>
    </div>

    <!-- â”€â”€ Access-granted flash â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="granted-overlay" id="grantedOverlay">
      <div class="granted-card">
        <span class="granted-icon">âœ…</span>
        <div class="granted-title">Access Granted!</div>
      </div>
    </div>

    <div class="container" id="mainContainer">
      <h1>ğŸ›¡ï¸ Security Verification</h1>
      <p class="subtitle">
        Please answer the following questions to verify you're human and gain access to XMenu.
      </p>

      <div class="info-box">
        <strong>Why am I seeing this?</strong><br />
        This security check helps protect XMenu from automated bots and ensures a safe experience for all users.
      </div>

      <form id="securityForm">
        <div class="question">
          <label class="question-label" for="q1">
            What is the result of 7 + 5?
          </label>
          <input
            type="text"
            id="q1"
            name="q1"
            class="question-input"
            placeholder="Enter your answer"
            required
          />
        </div>

        <div class="question">
          <label class="question-label" for="q2">
            What color is the sky on a clear day?
          </label>
          <input
            type="text"
            id="q2"
            name="q2"
            class="question-input"
            placeholder="Enter your answer"
            required
          />
        </div>

        <div class="question">
          <label class="question-label" for="q3">
            Complete the sequence: 2, 4, 6, 8, __
          </label>
          <input
            type="text"
            id="q3"
            name="q3"
            class="question-input"
            placeholder="Enter the next number"
            required
          />
        </div>

        <button type="submit" class="submit-btn">Verify & Continue</button>

        <div class="error-message" id="errorMessage"></div>
        <div class="attempts-warning" id="attemptsWarning"></div>
        <div class="loader" id="loader">
          <div class="spinner"></div>
          <div class="loader-text">Verifying your answersâ€¦</div>
        </div>
      </form>
    </div>

    <script>
      // â”€â”€ DOM refs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      const precheckOverlay   = document.getElementById("precheckOverlay");
      const countdownRing     = document.getElementById("countdownRing");
      const countdownNum      = document.getElementById("countdownNum");
      const skipBtn           = document.getElementById("skipBtn");
      const codeModalBackdrop = document.getElementById("codeModalBackdrop");
      const codeInput         = document.getElementById("codeInput");
      const codeError         = document.getElementById("codeError");
      const codeSubmitBtn     = document.getElementById("codeSubmitBtn");
      const codeCancelBtn     = document.getElementById("codeCancelBtn");
      const grantedOverlay    = document.getElementById("grantedOverlay");
      const mainContainer     = document.getElementById("mainContainer");
      const securityForm      = document.getElementById("securityForm");
      const errorMessage      = document.getElementById("errorMessage");
      const attemptsWarning   = document.getElementById("attemptsWarning");
      const loader            = document.getElementById("loader");

      // â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // NOTE: The bypass code is intentionally client-side; this repo has no backend.
      // It provides a convenience shortcut, not a strong security guarantee.
      const BYPASS_CODE   = "9182";
      const RING_CIRCUMF  = 2 * Math.PI * 35; // â‰ˆ 219.9

      // Get returnTo from URL early so we can use it in grantAccess()
      const urlParams = new URLSearchParams(window.location.search);
      const returnTo  = urlParams.get("returnTo") || "https://xmenu.dev/";

      function grantAccess() {
        // Store verified status in sessionStorage
        const verificationToken = generateToken();
        const expirationTime    = Date.now() + 24 * 60 * 60 * 1000;
        sessionStorage.setItem("xmenu_verified",             "true");
        sessionStorage.setItem("xmenu_verification_token",   verificationToken);
        sessionStorage.setItem("xmenu_verification_expiry",  expirationTime.toString());
        sessionStorage.removeItem("xmenu_security_attempts");
        sessionStorage.removeItem("xmenu_security_lockout");

        // Show access-granted animation then redirect
        grantedOverlay.classList.add("show");
        const separator = returnTo.includes("?") ? "&" : "?";
        setTimeout(() => {
          window.location.href = returnTo + separator + "verified=true";
        }, 900);
      }

      function generateToken() {
        const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
        let token = "";
        for (let i = 0; i < 32; i++) {
          token += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return token;
      }

      function dismissPrecheck() {
        precheckOverlay.classList.add("fade-out");
        setTimeout(() => {
          precheckOverlay.style.display = "none";
          mainContainer.classList.add("visible");
        }, 500);
      }

      // â”€â”€ Pre-check countdown (3 seconds) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // If user is already verified via sessionStorage, skip the pre-check
      (function redirectIfAlreadyVerified() {
        const isVerified      = sessionStorage.getItem("xmenu_verified") === "true";
        const verificationExp = parseInt(sessionStorage.getItem("xmenu_verification_expiry") || "0");
        if (isVerified && Date.now() < verificationExp) {
          // Already verified â€“ redirect immediately without showing anything
          const separator = returnTo.includes("?") ? "&" : "?";
          window.location.href = returnTo + separator + "verified=true";
        }
      })();

      let countdownValue   = 3;
      let activeInterval   = null;  // single shared reference prevents duplicate intervals

      // Initialize ring to full circle
      countdownRing.style.strokeDashoffset = "0";

      function startCountdown() {
        if (activeInterval) clearInterval(activeInterval); // cancel any existing interval
        activeInterval = setInterval(() => {
          countdownValue--;
          countdownNum.textContent = countdownValue;

          // Shrink the ring: offset goes from 0 â†’ RING_CIRCUMF over 3 steps
          const offset = ((3 - countdownValue) / 3) * RING_CIRCUMF;
          countdownRing.style.strokeDashoffset = offset.toString();

          if (countdownValue <= 0) {
            clearInterval(activeInterval);
            activeInterval = null;
            dismissPrecheck();
          }
        }, 1000);
      }

      startCountdown();

      // â”€â”€ Skip button â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      skipBtn.addEventListener("click", () => {
        if (activeInterval) { clearInterval(activeInterval); activeInterval = null; }
        codeError.textContent = "";
        codeInput.value = "";
        codeModalBackdrop.classList.add("show");
        setTimeout(() => codeInput.focus(), 50);
      });

      // â”€â”€ Code modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      function submitCode() {
        const entered = codeInput.value.trim();
        if (entered === BYPASS_CODE) {
          codeModalBackdrop.classList.remove("show");
          precheckOverlay.style.display = "none";
          grantAccess();
        } else {
          codeError.textContent = "Incorrect code. Please try again.";
          codeInput.value = "";
          codeInput.focus();
        }
      }

      codeSubmitBtn.addEventListener("click", submitCode);

      codeInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") submitCode();
      });

      codeCancelBtn.addEventListener("click", () => {
        codeModalBackdrop.classList.remove("show");
        // Resume countdown if time remains; otherwise dismiss immediately
        if (countdownValue > 0) {
          startCountdown();
        } else {
          dismissPrecheck();
        }
      });

      // Close modal on backdrop click
      codeModalBackdrop.addEventListener("click", (e) => {
        if (e.target === codeModalBackdrop) codeCancelBtn.click();
      });

      // â”€â”€ Security-form logic â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      // Define correct answers (case-insensitive; multiple languages supported)
      const correctAnswers = {
        q1: ["12", "twelve"],
        q2: ["blue", "blau"], // English and German accepted
        q3: ["10", "ten"]
      };

      // Track attempts
      const MAX_ATTEMPTS = 3;
      let attempts = parseInt(sessionStorage.getItem("xmenu_security_attempts") || "0");

      // Check if user has too many failed attempts
      if (attempts >= MAX_ATTEMPTS) {
        const lockoutTime    = parseInt(sessionStorage.getItem("xmenu_security_lockout") || "0");
        const now            = Date.now();
        const lockoutDuration = 5 * 60 * 1000;

        if (now < lockoutTime) {
          const remainingTime = Math.ceil((lockoutTime - now) / 1000 / 60);
          errorMessage.textContent = `Too many failed attempts. Please try again in ${remainingTime} minute(s).`;
          errorMessage.classList.add("show");
          securityForm.querySelector(".submit-btn").disabled = true;
          securityForm.querySelector(".submit-btn").style.opacity = "0.5";
          securityForm.querySelector(".submit-btn").style.cursor = "not-allowed";
        } else {
          attempts = 0;
          sessionStorage.setItem("xmenu_security_attempts", "0");
          sessionStorage.removeItem("xmenu_security_lockout");
        }
      }

      if (attempts > 0 && attempts < MAX_ATTEMPTS) {
        attemptsWarning.textContent = `âš ï¸ Warning: ${attempts} of ${MAX_ATTEMPTS} attempts used. ${MAX_ATTEMPTS - attempts} remaining.`;
        attemptsWarning.classList.add("show");
      }

      securityForm.addEventListener("submit", async (event) => {
        event.preventDefault();

        if (attempts >= MAX_ATTEMPTS) {
          const lockoutTime = parseInt(sessionStorage.getItem("xmenu_security_lockout") || "0");
          if (Date.now() < lockoutTime) return;
        }

        loader.classList.add("show");
        errorMessage.classList.remove("show");
        attemptsWarning.classList.remove("show");

        await new Promise(resolve => setTimeout(resolve, 1000));

        const formData = new FormData(securityForm);
        const answers  = {
          q1: formData.get("q1").trim().toLowerCase(),
          q2: formData.get("q2").trim().toLowerCase(),
          q3: formData.get("q3").trim().toLowerCase()
        };

        let allCorrect = true;
        for (const [key, value] of Object.entries(answers)) {
          if (!correctAnswers[key].includes(value)) {
            allCorrect = false;
            break;
          }
        }

        loader.classList.remove("show");

        if (allCorrect) {
          grantAccess();
        } else {
          attempts++;
          sessionStorage.setItem("xmenu_security_attempts", attempts.toString());

          if (attempts >= MAX_ATTEMPTS) {
            const lockoutTime = Date.now() + 5 * 60 * 1000;
            sessionStorage.setItem("xmenu_security_lockout", lockoutTime.toString());
            errorMessage.textContent = "Too many failed attempts. You've been locked out for 5 minutes.";
            securityForm.querySelector(".submit-btn").disabled = true;
            securityForm.querySelector(".submit-btn").style.opacity = "0.5";
            securityForm.querySelector(".submit-btn").style.cursor = "not-allowed";
          } else {
            errorMessage.textContent = `Incorrect answer(s). Please try again. (${attempts}/${MAX_ATTEMPTS} attempts used)`;
            attemptsWarning.textContent = `âš ï¸ Warning: ${attempts} of ${MAX_ATTEMPTS} attempts used. ${MAX_ATTEMPTS - attempts} remaining.`;
            attemptsWarning.classList.add("show");
          }

          errorMessage.classList.add("show");
        }
      });
    </script>
  </body>
</html>
